# Introduction lab exercises

Welcome to the Elastic Stack as Foundation lab exercises. During the lab exercises the student will experiential work through various tasks and activities to gain practical experience and develop new skills. In hands-on learning, attendees are given the opportunity to explore, experiment, and discover knowledge for themselves about Elastic Security.

The goal is to get actively engage and ask questions if something is not clear or you are blocked. Important to understand that there are no strong dependencies between labs, so it's okay if you're behind and follow your own pace.

The following key topics are part of these exercises:

- Exploring the Elastic Security UI
- Collecting data
- Setup a Teams Space

## Exercise 1 - Exploring the Elastic Security UI

This first exercise you are going to explore data that is generated by our Elastic Agent. To complete this exercise the following tasks must be completed.

### 1.1 - Ensure you can ping all Elastic services

All Elastic services must be resolvable using DNS or `hosts` file.

On Windows start `notepad.exe` with *run-as administrator* and edit the file `C:\Windows\System32\drivers\etc\hosts`.
Ensure you can open all extensions (*.*).

Add the following line

```
127.0.0.1       fleet-server kibana elasticsearch localhost zeek es01
```

### 1.2 - Prepare self-signed CA certificate

Ensure that you have copied the self-signed CA certificate to `C:\Elastic` directory.

```
mkdir -p C:\Elastic
cd C:\Elastic
docker cp es-cluster-elasticsearch-1:/usr/share/elasticsearch/config/certs/ca/ca.crt ca.crt
```

### 1.3 - Deploy the Elastic Agent locally

- Login Kibana.
- Open Fleet under Management. Fleet Central Management is opened.
- On tab Agent, click Add Agent.
- Select the Windows-Agent-Policy.
- Enroll in Fleet (Recommended).
- Install Elastic Agent on your host, choose Windows.

Now copy those five(5) lines and paste them in your favorite editor. Now ensure that `--certificate-authorities c:\Elastic\ca.crt` is added to the `enroll` command.

Example
```
.\elastic-agent.exe install --url=https://fleet-server:8220 --enrollment-token=<unique enrollment token> --certificate-authorities c:\Elastic\ca.crt
```

on an Administrator run-as PowerShell7 Terminal. After approx. 2 minutes the agent will be connected and the enrollment is confirmed. Click view enrolled agents.

### 1.4 - Now ensure Windows integration is activated for the Windows-Agent-Policy

- Open Fleet under Management. Fleet Central Management is opened. 
- On tab Agent Policies, click the Windows-Agent-Policy.
- Click Add integration.
- Search for Windows.
- Click Add Windows.
- Keep everything default for now and Save and continue.
- Save and deploy changes.

### 1.5 - Open Security Overview Dashboard

- Open Dashboards under Security.
- Now Open the Overview dashboard.
- Examine this dashboard and look if you can find your newly added host.
- Under Security click Explore.
- Examine the three ways to explore hosts, network and user activity.
- Under Users. Where are those Users coming from?

## Exercise 2 - Collecting data

### 2.1 - Lookup which index metricbeat data is stored

Here we are going to look where the `metricbeat` container stores their metrics.

- Open Infrastructure under Observability.
- Now Open Hosts. Metrics are collected from both host and containers.
- On the top right click Settings. You can see the index pattern used.
- Are these Elastic Agent compatible?

### 2.2 - Generate some data with logstash

Here we are going to look where the `logstash` container stores the data.

- Open Dev Tools under Management.
- Query for all indices `GET _cat/indices` . Look if there is a *logstash-*
- Now execute the following

```
docker exec -it es-cluster-logstash01-1 bash
echo "hello World" > ingest)_data/message
exit
```
- now search for the index again by `GET logstash*/_search`.
- Do you see your event? What do you recognize?

### 2.3 - Import CSV data
- Open Home.
- Click on Add integrations.
- Search for CSV.
- Click Upload a file to open the window.
- Great, let's upload our [ai_ml_cybersecurity_dataset](./content/ai_ml_cybersecurity_dataset.csv)
- Everything seems well mapped, but we can correct things here.
- Correct the fieldnames. Click override settings.
    - event.id
    - @timestamp
    - source.ip
    - destination.ip
    - user_agent.original
    - attack.type
    - attack.severity
    - attack.data.exfiltrated
    - attack.info
    - attack.response
- Click import.
- Ensure you have an index name like logs-import_aiml.
- Now view and analyse this imported data set. 
- Do the events show up in Security? Can you temporary achieve this using a Data view?


## Exercise 3 - Setup a Teams Space

### 2.1 - Create a space called secops

- Open Stack Management under management.
- Under Kibana open Spaces.
- Click create space.
- Add a space called *SecOps Team Space*.
- Only allow Security.
- Create space.

### 2.2 - Create a role called team_secops

- Open Stack Management under management.
- Under Security open Users.
- Click create role.
- Add a role team_secops with index privileges to only .alerts-security* , security_solution-* and logs-cloud_security* data views with privileges read, write and view_index_metadata.
- Give it access to the newly created space and all access for security features security and cases.
- Assign role.
- Close with create role.

### 2.3 - Create a test user called secops

- Open Stack Management under management.
- Under Security open Users.
- Click create user.
- Add a user called secops with a secure password, Wilkomme1.
- Give it the team_secops role.
- Create user.

### 2.4 - Test Space access

Now open an Incognito browser and login into Kibana with your test user called secops.

## Next Steps

You are ready to start with the second lab about [Elastic Stack as Fundament](../03-AdvancedIngestion/README.md) for Elastic Security. Be aware that the trainer might have to explain the training material and provide additional instructions for a jump start.

Enjoy the exercises!!!
